{% include 'includes/head.html' %}
{% if session.usuario_logado %}
{% include 'includes/navbar.html' %}
{% endif %}

<body>
  <div class="menu-container">
    <h2>Painel OFS</h2>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% for category, message in messages %}
    <p class="{{ 'success-msg' if category == 'success' else 'error-msg' }}">{{ message }}</p>
    {% endfor %}
    {% endwith %}

    <div class="card-grid">
      {# ====== OFS ====== #}
      {% if has_perm('ofs.atualizar_tipo') %}
      <a href="{{ url_for('atualizar_user_type') }}" class="card">
        <h3>Tipos de usuário</h3>
        <div class="card-description">
          <p>
            ➤ Altere o tipo de usuário de um ou mais técnicos.<br>
            ➤ Gerencie os tipos disponíveis de usuários.
          </p>
        </div>
      </a>
      {% endif %}

      {% if has_perm('ofs.consultar') %}
      <a href="{{ url_for('consultar_usuarios') }}" class="card">
        <h3>Consultar usuários</h3>
        <div class="card-description">
          <p>
            ➤ Lista todos os usuários cadastrados no OFS.<br>
            ➤ Exibe nome, login, status e XU_CODE_SAP.
          </p>
        </div>
      </a>
      {% endif %}

      {% if has_perm('ofs.desativar') %}
      <a href="{{ url_for('desativar_inativos') }}" class="card">
        <h3>Desativar usuários e recursos</h3>
        <div class="card-description">
          <p>
            ➤ Lista usuários sem acesso há muito tempo ou sem login.<br>
            ➤ Permite simular ou executar exclusão e inativação.
          </p>
        </div>
      </a>
      {% endif %}

      {% if has_perm('ofs.criar_tecnicos') %}
      <a href="{{ url_for('criar_tecnicos') }}" class="card">
        <h3>Criar técnicos</h3>
        <div class="card-description">
          <p>
            ➤ Envie um CSV e crie recurso + usuário no OFS (ambiente de teste).
          </p>
        </div>
      </a>
      {% endif %}

      {# ====== ADMIN / PORTAL ====== #}
      {% if has_perm('perfis.gerenciar') %}
      <a href="{{ url_for('perfis_view') }}" class="card">
        <h3>Gerenciar Perfis</h3>
        <div class="card-description">
          <p>
            ➤ Crie/edite perfis e permissões.<br>
            ➤ Controle de acesso do portal por tela.
          </p>
        </div>
      </a>
      {% endif %}

      {% if has_perm('usuarios.criar') %}
      <a href="{{ url_for('usuarios_painel') }}" class="card">
        <h3>Usuários do painel</h3>
        <div class="card-description">
          <p>
            ➤ Liste e filtre usuários do portal.<br>
            ➤ Visualize perfil e last login.
          </p>
        </div>
      </a>
      {% endif %}

      {% if has_perm('adapter.fechar_os') %}
      <a href="{{ url_for('fechar_os_adapter') }}" class="card">
        <h3>Fechar OS Adapter</h3>
        <div class="card-description">
          <p>
            ➤ Fecha OS manualmente quando a integração falha.<br>
            ➤ Pré-visualize dados antes de enviar.
          </p>
        </div>
      </a>
      {% endif %}
      {% if has_perm('sap.acompanhamento_critica') %}
      <a href="{{ url_for('sap_acompanhamento_critica') }}" class="card">
        <h3>Acompanhamento Crítica SAP</h3>
        <div class="card-description">
          <p>
            ➤ Acompanhamento e tratativa de críticas SAP.<br>
            ➤ Visão restrita por permissão.
          </p>
        </div>
      </a>
      {% endif %}

      {% if has_perm('ofs.atividades_notdone') %}
      <a href="{{ url_for('atividades_notdone') }}" class="card">
        <h3>Atividades notdone</h3>
        <div class="card-description">
          <p>
            ➤ Lista atividades notdone por data e resource.<br>
            ➤ Botão Tratar abre modal com detalhes.
          </p>
        </div>
      </a>
      {% endif %}
    </div>
  </div>

  {% include 'includes/footer.html' %}
</body>