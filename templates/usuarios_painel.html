{% include 'includes/head.html' %}
{% if session.usuario_logado %}
  {% include 'includes/navbar.html' %}
{% endif %}

<body>
  <div class="menu-container" style="max-width: 1000px;">
    <h2>Usuários do painel</h2>

    <p style="margin-top:8px; font-size:0.95rem;">
      Total de usuários: <strong>{{ usuarios|length }}</strong>
    </p>

    <!-- Filtro por perfil -->
    <form method="get" class="usuarios-filtro">
      <label for="perfil_id" style="font-size:0.9rem;">Filtrar por perfil:</label>
      <select id="perfil_id" name="perfil_id" onchange="this.form.submit()">
        <option value="">Todos os perfis</option>
        {% for p in perfis %}
          <option value="{{ p.id }}" {% if perfil_id_selecionado == p.id %}selected{% endif %}>
            {{ p.nome }}
          </option>
        {% endfor %}
      </select>
    </form>

    <div class="tabela-container" style="margin-top:24px;">
      <table class="tabela-usuarios">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nome</th>
            <th>Login (username)</th>
            <th>Perfil</th>
            <th>Last login</th>
          </tr>
        </thead>
        <tbody>
          {% for u in usuarios %}
            <tr>
              <td>{{ u.id }}</td>
              <td>{{ u.nome }}</td>
              <td>{{ u.username }}</td>
              <td>{{ u.perfil_nome or '-' }}</td>
              <td>
                {% if u.last_login %}
                  {{ u.last_login.strftime('%d/%m/%Y %H:%M') }}
                {% else %}
                  -
                {% endif %}
              </td>
            </tr>
          {% endfor %}

          {% if usuarios|length == 0 %}
            <tr>
              <td colspan="5">Nenhum usuário encontrado para esse filtro.</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>

    <div style="text-align:center; margin-top:18px;">
      <a href="{{ url_for('perfis_view') }}" class="btn-voltar">
        Voltar para perfis
      </a>
    </div>
  </div>
</body>

{% include 'includes/footer.html' %}
